# Changes to the Data Structure

## 1. Update the database schema

Edit `database/migrations/00002_init_schema.up.sql` then run `make reset`. This will drop and recreate the database schema - it will also apply migrations.

## 2. Update the data model

The data model is mapped from queries by
[SQLC](https://docs.sqlc.dev/en/latest/). The config file `sqlc.yaml` defines
the behaviour and mappings between schema, queries and models.

The queries are defined in `database/query` with one `sql` file representing
each model. To add a new model, create a new file and define the behaviour of
CRUD operations.

- `CreateWidget`
- `GetWidget`
- `ListWidgets`
- `DeleteWidget`

By default a `GetWidget` is implicitly _get one widget by id_ however other queries can be defined here to lookup by another field or filter etc. 
Aggregate views that relate to a model should be defined here -- more complete queries with joins should be in a separate file.

After updating the `sqlc` files run `make sqlc` to rebuild the models.


## 3. Test your models

Model files are generated by `sqlc` are read-only and are created in `internal/models`. However tests are not auto-generated for models and should be created manually.
Every model should have a test file named `widget_test.go`.  Add tests for CRUD operations as a minimum.

